<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task 22.2 - Media Segment Monitoring æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #007cba;
            padding-bottom: 10px;
        }
        h2 {
            color: #007cba;
            margin-top: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .button {
            background-color: #007cba;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .button:hover {
            background-color: #005a87;
        }
        .button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .data-display {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .video-container {
            margin: 20px 0;
            text-align: center;
        }
        video {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #e9ecef;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007cba;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .log-entry {
            padding: 5px;
            margin: 2px 0;
            border-left: 3px solid #007cba;
            background-color: #f1f3f4;
            font-family: monospace;
            font-size: 11px;
        }
        .segment-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .segment-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            font-family: monospace;
            font-size: 11px;
        }
        .segment-item:nth-child(even) {
            background-color: #f9f9f9;
        }
        .bandwidth-info {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        .bandwidth-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¬ Task 22.2 - Media Segment Monitoring æ¸¬è©¦</h1>
        <p>é€™å€‹é é¢ç”¨æ–¼æ¸¬è©¦ Chrome æ“´å±•çš„åª’é«”ç‰‡æ®µç›£æ§åŠŸèƒ½ã€‚</p>
        
        <div class="test-section">
            <h2>ğŸ”— æ“´å±•é€£æ¥æ¸¬è©¦</h2>
            <div style="margin-bottom: 10px;">
                <label for="extensionIdInput">æ“´å±• ID (å¯é¸):</label>
                <input type="text" id="extensionIdInput" placeholder="å¦‚æœè‡ªå‹•æª¢æ¸¬å¤±æ•—ï¼Œè«‹åœ¨æ­¤è¼¸å…¥æ“´å±• ID" 
                       style="width: 300px; margin-left: 10px; padding: 5px;">
                <button class="button" onclick="getExtensionIdFromChrome()" style="margin-left: 10px;">ç²å–èªªæ˜</button>
            </div>
            <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                ğŸ’¡ å¦‚éœ€æ‰‹å‹•ç²å–æ“´å±• IDï¼š
                <a href="get-extension-id.html" target="_blank" style="color: #007bff;">é–‹å•Ÿæ“´å±• ID å·¥å…·</a> 
                æˆ–å‰å¾€ <strong>chrome://extensions/</strong> â†’ é–‹å•Ÿã€Œé–‹ç™¼è€…æ¨¡å¼ã€â†’ æ‰¾åˆ°ã€ŒCDN Detectorã€æ“´å±•çš„ ID
            </div>
            <button class="button" onclick="testExtensionConnection()">æ¸¬è©¦æ“´å±•é€£æ¥</button>
            <div id="connectionStatus"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š åª’é«”ç‰‡æ®µçµ±è¨ˆ</h2>
            <button class="button" onclick="getMediaSegmentStats()">ç²å–çµ±è¨ˆè³‡æ–™</button>
            <button class="button" onclick="clearMediaSegmentData()">æ¸…é™¤è³‡æ–™</button>
            <div id="segmentStats"></div>
            
            <div class="stats-grid" id="statsGrid" style="display: none;">
                <div class="stat-card">
                    <div class="stat-value" id="totalSegments">0</div>
                    <div class="stat-label">ç¸½ç‰‡æ®µæ•¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalBytes">0</div>
                    <div class="stat-label">ç¸½å¤§å° (MB)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dashSegments">0</div>
                    <div class="stat-label">DASH ç‰‡æ®µ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="hlsSegments">0</div>
                    <div class="stat-label">HLS ç‰‡æ®µ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="cachedSegments">0</div>
                    <div class="stat-label">å¿«å–ç‰‡æ®µ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgBandwidth">0</div>
                    <div class="stat-label">å¹³å‡é »å¯¬ (KB/s)</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>âš¡ å³æ™‚é »å¯¬ç›£æ§</h2>
            <button class="button" onclick="startBandwidthMonitoring()">é–‹å§‹ç›£æ§</button>
            <button class="button" onclick="stopBandwidthMonitoring()">åœæ­¢ç›£æ§</button>
            
            <div class="bandwidth-info" id="bandwidthInfo" style="display: none;">
                <div class="bandwidth-card">
                    <div style="font-size: 18px; font-weight: bold;" id="recentAvg">0 KB/s</div>
                    <div style="font-size: 12px;">è¿‘æœŸå¹³å‡</div>
                </div>
                <div class="bandwidth-card">
                    <div style="font-size: 18px; font-weight: bold;" id="peakBandwidth">0 KB/s</div>
                    <div style="font-size: 12px;">å³°å€¼é »å¯¬</div>
                </div>
                <div class="bandwidth-card">
                    <div style="font-size: 18px; font-weight: bold;" id="minBandwidth">âˆ KB/s</div>
                    <div style="font-size: 12px;">æœ€ä½é »å¯¬</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ ç‰‡æ®µè©³ç´°è³‡æ–™</h2>
            <button class="button" onclick="getMediaSegmentData()">ç²å–ç‰‡æ®µè³‡æ–™</button>
            <div id="segmentData"></div>
            
            <div class="segment-list" id="segmentList" style="display: none;">
                <!-- ç‰‡æ®µåˆ—è¡¨å°‡åœ¨é€™è£¡é¡¯ç¤º -->
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ¥ æ¸¬è©¦å½±ç‰‡</h2>
            <p>æ’­æ”¾é€™äº›å½±ç‰‡ä¾†è§¸ç™¼åª’é«”ç‰‡æ®µæª¢æ¸¬ï¼š</p>
            
            <div class="video-container">
                <h3>DASH æ¸¬è©¦å½±ç‰‡</h3>
                <video controls crossorigin="anonymous">
                    <source src="https://dash.akamaized.net/akamai/bbb_30fps/bbb_30fps.mpd" type="application/dash+xml">
                    æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ DASH æ’­æ”¾ã€‚
                </video>
            </div>

            <div class="video-container">
                <h3>HLS æ¸¬è©¦å½±ç‰‡</h3>
                <video controls crossorigin="anonymous">
                    <source src="https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8" type="application/x-mpegURL">
                    æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ HLS æ’­æ”¾ã€‚
                </video>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“ æ¸¬è©¦æ—¥èªŒ</h2>
            <button class="button" onclick="clearTestLog()">æ¸…é™¤æ—¥èªŒ</button>
            <div id="testLog" class="data-display" style="max-height: 200px;"></div>
        </div>
    </div>

    <script>
        let monitoringInterval = null;
        
        function logMessage(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            
            const testLog = document.getElementById('testLog');
            testLog.appendChild(logEntry);
            testLog.scrollTop = testLog.scrollHeight;
            
            console.log(`[${timestamp}] ${message}`);
        }

        function showStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        async function testExtensionConnection() {
            try {
                logMessage('æ¸¬è©¦æ“´å±•é€£æ¥...', 'info');
                
                // ç²å–æ“´å±• ID
                const extensionId = await getExtensionId();
                if (!extensionId) {
                    showStatus('connectionStatus', 'âŒ ç„¡æ³•æ‰¾åˆ° CDN Detector æ“´å±•', 'error');
                    logMessage('ç„¡æ³•æ‰¾åˆ° CDN Detector æ“´å±•', 'error');
                    return;
                }
                
                const response = await chrome.runtime.sendMessage(extensionId, {
                    type: 'PING'
                });
                
                if (response && response.status === 'ok') {
                    showStatus('connectionStatus', `âœ… æ“´å±•é€£æ¥æˆåŠŸï¼Extension ID: ${extensionId}`, 'success');
                    logMessage('æ“´å±•é€£æ¥æ¸¬è©¦æˆåŠŸ', 'info');
                    
                    // å„²å­˜æ“´å±• ID ä¾›å¾ŒçºŒä½¿ç”¨
                    window.cdnDetectorExtensionId = extensionId;
                } else {
                    showStatus('connectionStatus', 'âŒ æ“´å±•å›æ‡‰ç•°å¸¸', 'error');
                    logMessage('æ“´å±•å›æ‡‰ç•°å¸¸', 'error');
                }
            } catch (error) {
                showStatus('connectionStatus', `âŒ æ“´å±•é€£æ¥å¤±æ•—: ${error.message}`, 'error');
                logMessage(`æ“´å±•é€£æ¥å¤±æ•—: ${error.message}`, 'error');
            }
        }

        async function getExtensionId() {
            // é¦–å…ˆæª¢æŸ¥æ‰‹å‹•è¼¸å…¥çš„ ID
            const manualId = document.getElementById('extensionIdInput').value.trim();
            if (manualId) {
                try {
                    await chrome.runtime.sendMessage(manualId, {type: 'PING'});
                    logMessage(`ä½¿ç”¨æ‰‹å‹•è¼¸å…¥çš„æ“´å±• ID: ${manualId}`, 'info');
                    return manualId;
                } catch (error) {
                    logMessage(`æ‰‹å‹•è¼¸å…¥çš„æ“´å±• ID ç„¡æ•ˆ: ${error.message}`, 'error');
                }
            }
            
            // å˜—è©¦ä¸€äº›å¸¸è¦‹çš„æ“´å±• ID æ ¼å¼
            const commonPatterns = [
                // Chrome æ“´å±• ID é€šå¸¸æ˜¯ 32 ä½çš„å­—æ¯æ•¸å­—çµ„åˆ
                'abcdefghijklmnopqrstuvwxyz123456', // ç¤ºä¾‹æ ¼å¼
                'cdndetector' + Math.random().toString(36).substr(2, 20) // éš¨æ©Ÿç”Ÿæˆç¤ºä¾‹
            ];
            
            logMessage('ç„¡æ³•è‡ªå‹•ç²å–æ“´å±• IDï¼Œè«‹æ‰‹å‹•è¼¸å…¥', 'info');
            logMessage('å‰å¾€ chrome://extensions/ â†’ é–‹å•Ÿé–‹ç™¼è€…æ¨¡å¼ â†’ æŸ¥çœ‹ CDN Detector çš„ ID', 'info');
            return null;
        }

        async function getExtensionIdFromChrome() {
            logMessage('æä¾›æ“´å±• ID ç²å–æŒ‡å¼•...', 'info');
            
            const instructions = `
ğŸ“‹ æ‰‹å‹•ç²å–æ“´å±• ID æ­¥é©Ÿï¼š
1. é–‹å•Ÿæ–°æ¨™ç±¤é ï¼Œå‰å¾€ï¼šchrome://extensions/
2. é–‹å•Ÿå³ä¸Šè§’çš„ã€Œé–‹ç™¼è€…æ¨¡å¼ã€é–‹é—œ
3. æ‰¾åˆ°ã€ŒCDN Detectorã€æ“´å±•
4. è¤‡è£½æ“´å±•å¡ç‰‡ä¸Šé¡¯ç¤ºçš„ IDï¼ˆ32ä½å­—æ¯æ•¸å­—çµ„åˆï¼‰
5. å°‡ ID è²¼åˆ°ä¸Šæ–¹çš„è¼¸å…¥æ¡†ä¸­
6. é»æ“Šã€Œæ¸¬è©¦æ“´å±•é€£æ¥ã€æŒ‰éˆ•
            `;
            
            logMessage(instructions, 'info');
            showStatus('connectionStatus', 'ğŸ“‹ è«‹æŒ‰ç…§æ¸¬è©¦æ—¥èªŒä¸­çš„æ­¥é©Ÿæ‰‹å‹•ç²å–æ“´å±• ID', 'info');
            
            // å˜—è©¦é–‹å•Ÿæ“´å±•é é¢ï¼ˆå¯èƒ½æœƒè¢«ç€è¦½å™¨é˜»æ“‹ï¼‰
            try {
                window.open('chrome://extensions/', '_blank');
                logMessage('å·²å˜—è©¦é–‹å•Ÿæ“´å±•ç®¡ç†é é¢', 'info');
            } catch (error) {
                logMessage('ç„¡æ³•è‡ªå‹•é–‹å•Ÿæ“´å±•ç®¡ç†é é¢ï¼Œè«‹æ‰‹å‹•å‰å¾€ chrome://extensions/', 'info');
            }
        }

        async function getMediaSegmentStats() {
            try {
                logMessage('ç²å–åª’é«”ç‰‡æ®µçµ±è¨ˆ...', 'info');
                
                const extensionId = window.cdnDetectorExtensionId || await getExtensionId();
                if (!extensionId) {
                    showStatus('segmentStats', 'âŒ ç„¡æ³•æ‰¾åˆ° CDN Detector æ“´å±•', 'error');
                    return;
                }
                
                const response = await chrome.runtime.sendMessage(extensionId, {
                    type: 'GET_MEDIA_SEGMENT_STATS'
                });
                
                if (response && response.success) {
                    const stats = response.stats;
                    showStatus('segmentStats', 'âœ… çµ±è¨ˆè³‡æ–™ç²å–æˆåŠŸ', 'success');
                    
                    // æ›´æ–°çµ±è¨ˆå¡ç‰‡
                    document.getElementById('totalSegments').textContent = stats.summary.totalSegments;
                    document.getElementById('totalBytes').textContent = (stats.summary.totalBytes / (1024 * 1024)).toFixed(2);
                    document.getElementById('dashSegments').textContent = stats.summary.totalDashSegments;
                    document.getElementById('hlsSegments').textContent = stats.summary.totalHlsSegments;
                    document.getElementById('cachedSegments').textContent = stats.summary.totalCachedSegments;
                    
                    // è¨ˆç®—å¹³å‡é »å¯¬
                    const avgBandwidth = stats.activeTabData ? 
                        Math.round(stats.activeTabData.stats.averageBandwidth / 1024) : 0;
                    document.getElementById('avgBandwidth').textContent = avgBandwidth;
                    
                    document.getElementById('statsGrid').style.display = 'grid';
                    
                    logMessage(`çµ±è¨ˆ: ${stats.summary.totalSegments} ç‰‡æ®µ, ${stats.totalTabs} æ¨™ç±¤é `, 'info');
                } else {
                    showStatus('segmentStats', `âŒ ç²å–çµ±è¨ˆå¤±æ•—: ${response?.error || 'æœªçŸ¥éŒ¯èª¤'}`, 'error');
                    logMessage(`ç²å–çµ±è¨ˆå¤±æ•—: ${response?.error || 'æœªçŸ¥éŒ¯èª¤'}`, 'error');
                }
            } catch (error) {
                showStatus('segmentStats', `âŒ è«‹æ±‚å¤±æ•—: ${error.message}`, 'error');
                logMessage(`è«‹æ±‚å¤±æ•—: ${error.message}`, 'error');
            }
        }

        async function clearMediaSegmentData() {
            try {
                logMessage('æ¸…é™¤åª’é«”ç‰‡æ®µè³‡æ–™...', 'info');
                
                const extensionId = window.cdnDetectorExtensionId || await getExtensionId();
                if (!extensionId) {
                    showStatus('segmentStats', 'âŒ ç„¡æ³•æ‰¾åˆ° CDN Detector æ“´å±•', 'error');
                    return;
                }
                
                const response = await chrome.runtime.sendMessage(extensionId, {
                    type: 'CLEAR_MEDIA_SEGMENT_DATA'
                });
                
                if (response && response.success) {
                    showStatus('segmentStats', 'âœ… è³‡æ–™æ¸…é™¤æˆåŠŸ', 'success');
                    logMessage('åª’é«”ç‰‡æ®µè³‡æ–™å·²æ¸…é™¤', 'info');
                    
                    // é‡ç½®é¡¯ç¤º
                    document.getElementById('statsGrid').style.display = 'none';
                    document.getElementById('segmentList').style.display = 'none';
                    document.getElementById('bandwidthInfo').style.display = 'none';
                } else {
                    showStatus('segmentStats', `âŒ æ¸…é™¤å¤±æ•—: ${response?.error || 'æœªçŸ¥éŒ¯èª¤'}`, 'error');
                    logMessage(`æ¸…é™¤å¤±æ•—: ${response?.error || 'æœªçŸ¥éŒ¯èª¤'}`, 'error');
                }
            } catch (error) {
                showStatus('segmentStats', `âŒ è«‹æ±‚å¤±æ•—: ${error.message}`, 'error');
                logMessage(`è«‹æ±‚å¤±æ•—: ${error.message}`, 'error');
            }
        }

        async function getMediaSegmentData() {
            try {
                logMessage('ç²å–åª’é«”ç‰‡æ®µè©³ç´°è³‡æ–™...', 'info');
                
                const extensionId = window.cdnDetectorExtensionId || await getExtensionId();
                if (!extensionId) {
                    showStatus('segmentData', 'âŒ ç„¡æ³•æ‰¾åˆ° CDN Detector æ“´å±•', 'error');
                    return;
                }
                
                const response = await chrome.runtime.sendMessage(extensionId, {
                    type: 'GET_MEDIA_SEGMENT_DATA'
                });
                
                if (response && response.success) {
                    const data = response.data;
                    showStatus('segmentData', 'âœ… ç‰‡æ®µè³‡æ–™ç²å–æˆåŠŸ', 'success');
                    
                    // é¡¯ç¤ºç‰‡æ®µåˆ—è¡¨
                    const segmentList = document.getElementById('segmentList');
                    segmentList.innerHTML = '';
                    
                    if (data.segments && data.segments.segments.length > 0) {
                        data.segments.segments.slice(-20).forEach((segment, index) => {
                            const segmentItem = document.createElement('div');
                            segmentItem.className = 'segment-item';
                            
                            const downloadTime = segment.downloadTime || 0;
                            const bandwidth = segment.bandwidth ? Math.round(segment.bandwidth / 1024) : 0;
                            const size = segment.contentLength ? Math.round(segment.contentLength / 1024) : 0;
                            
                            segmentItem.innerHTML = `
                                <strong>[${segment.segmentType}]</strong> 
                                ${segment.url.substring(0, 80)}...<br>
                                ğŸ“Š å¤§å°: ${size} KB | â±ï¸ æ™‚é–“: ${downloadTime}ms | 
                                âš¡ é »å¯¬: ${bandwidth} KB/s | 
                                ğŸ’¾ å¿«å–: ${segment.fromCache ? 'æ˜¯' : 'å¦'}
                            `;
                            segmentList.appendChild(segmentItem);
                        });
                        
                        segmentList.style.display = 'block';
                        logMessage(`é¡¯ç¤ºæœ€è¿‘ ${Math.min(20, data.segments.segments.length)} å€‹ç‰‡æ®µ`, 'info');
                    } else {
                        segmentList.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">å°šç„¡åª’é«”ç‰‡æ®µè³‡æ–™</div>';
                        segmentList.style.display = 'block';
                        logMessage('ç›®å‰æ²’æœ‰åª’é«”ç‰‡æ®µè³‡æ–™', 'info');
                    }
                } else {
                    showStatus('segmentData', `âŒ ç²å–è³‡æ–™å¤±æ•—: ${response?.error || 'æœªçŸ¥éŒ¯èª¤'}`, 'error');
                    logMessage(`ç²å–è³‡æ–™å¤±æ•—: ${response?.error || 'æœªçŸ¥éŒ¯èª¤'}`, 'error');
                }
            } catch (error) {
                showStatus('segmentData', `âŒ è«‹æ±‚å¤±æ•—: ${error.message}`, 'error');
                logMessage(`è«‹æ±‚å¤±æ•—: ${error.message}`, 'error');
            }
        }

        async function updateBandwidthDisplay() {
            try {
                const extensionId = window.cdnDetectorExtensionId || await getExtensionId();
                if (!extensionId) return; // éœé»˜è™•ç†
                
                const response = await chrome.runtime.sendMessage(extensionId, {
                    type: 'GET_MEDIA_SEGMENT_DATA'
                });
                
                if (response && response.success && response.data.bandwidth) {
                    const bandwidth = response.data.bandwidth;
                    
                    document.getElementById('recentAvg').textContent = 
                        Math.round(bandwidth.recentAverage / 1024) + ' KB/s';
                    document.getElementById('peakBandwidth').textContent = 
                        Math.round(bandwidth.peakBandwidth / 1024) + ' KB/s';
                    document.getElementById('minBandwidth').textContent = 
                        bandwidth.minBandwidth !== Infinity ? 
                        Math.round(bandwidth.minBandwidth / 1024) + ' KB/s' : 'âˆ KB/s';
                    
                    document.getElementById('bandwidthInfo').style.display = 'grid';
                }
            } catch (error) {
                // éœé»˜è™•ç†éŒ¯èª¤ï¼Œé¿å…å¹²æ“¾ç›£æ§
            }
        }

        function startBandwidthMonitoring() {
            if (monitoringInterval) {
                logMessage('é »å¯¬ç›£æ§å·²åœ¨é‹è¡Œ', 'info');
                return;
            }
            
            logMessage('é–‹å§‹å³æ™‚é »å¯¬ç›£æ§...', 'info');
            monitoringInterval = setInterval(updateBandwidthDisplay, 2000);
            updateBandwidthDisplay(); // ç«‹å³æ›´æ–°ä¸€æ¬¡
        }

        function stopBandwidthMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
                logMessage('é »å¯¬ç›£æ§å·²åœæ­¢', 'info');
            }
        }

        function clearTestLog() {
            document.getElementById('testLog').innerHTML = '';
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æ¸¬è©¦é€£æ¥
        window.addEventListener('load', () => {
            logMessage('Task 22.2 æ¸¬è©¦é é¢å·²è¼‰å…¥', 'info');
            setTimeout(testExtensionConnection, 1000);
        });

        // å®šæœŸæ›´æ–°çµ±è¨ˆï¼ˆå¦‚æœæœ‰ç›£æ§åœ¨é‹è¡Œï¼‰
        setInterval(() => {
            if (monitoringInterval) {
                getMediaSegmentStats();
            }
        }, 5000);
    </script>
</body>
</html> 