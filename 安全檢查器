# CDN Detector 第一階段擴充 - 安全檢查器

我想要為我的 Chrome Extension "CDN Detector" 新增**安全檢查器**功能，這是第一階段的擴充開發。

## 🚨 關鍵約束：零影響現有系統

### 絕對要求
1. **現有 CDN 檢測功能**
2. **現有的 webRequest 監聽器保持獨立**
3. **現有的資料結構 (tabDetectionData) 不可變更**
4. **現有的 UI 介面必須完全保持**
5. **任何新功能錯誤不可影響 CDN 檢測**
6. **效能不可下降，記憶體增加不超過 15%**

### 實現策略
- **並行檢測**：安全檢測與 CDN 檢測並行運行
- **獨立儲存**：使用不同的 storage key 前綴
- **錯誤隔離**：完整的 try-catch 包裝
- **降級機制**：安全檢測失敗時自動停用

## 安全檢查器功能需求

### 主要檢測項目

#### 1. 核心安全 Headers
**Content-Security-Policy (CSP)**
- 檢測 CSP header 是否存在
- 分析 CSP 指令的完整性：
  - `default-src` 設定
  - `script-src` 和 `unsafe-inline`/`unsafe-eval` 檢查
  - `object-src` 限制
  - `frame-ancestors` 設定
- CSP 評分機制 (0-100 分)
- 常見 CSP 弱點識別

**Frame Protection**
- `X-Frame-Options` header 檢測
- `frame-ancestors` CSP 指令檢查
- Clickjacking 防護評估

**Content Type Protection**
- `X-Content-Type-Options: nosniff` 檢測
- MIME type sniffing 攻擊防護評估

**XSS Protection (已棄用但仍檢測)**
- `X-XSS-Protection` header 檢測
- 檢測是否設為 `1; mode=block`

**HTTPS Transport Security**
- `Strict-Transport-Security` (HSTS) 檢測
- HSTS 設定分析：
  - `max-age` 值檢查
  - `includeSubDomains` 檢查
  - `preload` 指令檢查

**Referrer Policy**
- `Referrer-Policy` header 檢測
- 隱私權保護等級評估

**Feature/Permissions Policy**
- `Permissions-Policy` (新標準) 檢測
- `Feature-Policy` (舊標準) 檢測
- 瀏覽器功能權限控制分析

#### 2. HTTPS 安全性檢查
**Mixed Content 檢測**
- 在 HTTPS 頁面中檢測 HTTP 資源
- 區分 Active Mixed Content vs Passive Mixed Content
- 提供具體的不安全資源清單

**SSL/TLS 基本檢查**
- 檢測頁面是否使用 HTTPS
- 檢測所有資源的傳輸協議
- 統計 HTTPS vs HTTP 資源比例

#### 3. Cookie 安全性
**Cookie 屬性分析**
- 檢測 `Set-Cookie` headers
- 分析 `Secure` 屬性設定
- 分析 `HttpOnly` 屬性設定
- 分析 `SameSite` 屬性設定
- 識別潛在的不安全 Cookie

#### 4. 基本隱私權檢查
**第三方資源追蹤**
- 識別第三方追蹤器域名
- Google Analytics, Facebook Pixel 等常見追蹤器
- 廣告網路檢測

**本地儲存分析**
- localStorage 使用檢測
- sessionStorage 使用檢測
- IndexedDB 使用檢測

### 檢測結果和評分系統

#### 安全性評分 (0-100)
**評分權重**：
- CSP 配置：25%
- HTTPS 使用：20%
- Frame Protection：15%
- Content Type Protection：10%
- HSTS 配置：10%
- Cookie 安全性：10%
- 其他 Headers：10%

**評分等級**：
- 90-100：優秀 (🟢 Excellent)
- 70-89：良好 (🟡 Good)
- 50-69：普通 (🟠 Fair)
- 30-49：需改善 (🔴 Poor)
- 0-29：危險 (⚫ Critical)

請幫我實現這個安全檢查器功能，重點要求：

1. **維持現有 CDN 以及影片偵測功能**
2. **實現完整的安全 Headers 檢測**
3. **建立可擴展的架構基礎**
4. **提供專業的安全評分系統**
