<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>擴展狀態檢查</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>CDN Detector 擴展狀態檢查</h1>
    
    <div class="section">
        <h2>📋 請按照以下步驟操作：</h2>
        <ol>
            <li>
                <strong>開啟擴展管理頁面</strong>
                <br>在新標籤頁中輸入：<code>chrome://extensions/</code>
            </li>
            <li>
                <strong>開啟開發者模式</strong>
                <br>點擊右上角的「開發者模式」開關
            </li>
            <li>
                <strong>找到 CDN Detector 擴展</strong>
                <br>查看以下資訊：
                <ul>
                    <li>是否顯示「錯誤」按鈕？如果有，點擊查看錯誤詳情</li>
                    <li>點擊「檢視檢查的背景頁面」或「Service Worker」連結</li>
                    <li>在開發者工具的 Console 中查看是否有錯誤</li>
                </ul>
            </li>
            <li>
                <strong>重新載入擴展</strong>
                <br>點擊擴展卡片上的重新載入按鈕（循環箭頭圖標）
            </li>
        </ol>
    </div>

    <div class="section">
        <h2>🔧 手動測試方法</h2>
        <p>如果上述方法都失敗，請嘗試以下替代方案：</p>
        
        <h3>方法 1：直接在擴展的 Service Worker 中測試</h3>
        <ol>
            <li>在擴展管理頁面，點擊 CDN Detector 的「Service Worker」連結</li>
            <li>在打開的開發者工具 Console 中，輸入以下命令測試 message listener：
                <pre>chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
    console.log('Test message received:', message);
    if (message.type === 'TEST') {
        sendResponse({success: true, message: 'Test successful!'});
    }
});</pre>
            </li>
            <li>然後在另一個標籤頁的 Console 中測試發送訊息：
                <pre>chrome.runtime.sendMessage('nonjdhdineehckicdnmnpmdapfdnlhbc', {type: 'TEST'}, response => {
    console.log('Response:', response);
});</pre>
            </li>
        </ol>

        <h3>方法 2：使用擴展的內部頁面</h3>
        <p>創建一個擴展內部的測試頁面可能會更容易連接。</p>
    </div>

    <div class="section">
        <h2>🐛 常見問題解決</h2>
        <h3>1. Service Worker 未啟動</h3>
        <p>如果 Service Worker 顯示「非作用中」，可能需要：</p>
        <ul>
            <li>點擊擴展圖標來啟動它</li>
            <li>完全關閉並重新開啟 Chrome</li>
            <li>移除並重新安裝擴展</li>
        </ul>

        <h3>2. 權限問題</h3>
        <p>確保測試頁面的 URL 在 manifest.json 的 externally_connectable 中：</p>
        <pre>{
  "externally_connectable": {
    "matches": [
      "file://*/*",
      "http://localhost/*",
      "https://localhost/*",
      "*://localhost:*/*",
      "*://127.0.0.1:*/*"
    ]
  }
}</pre>

        <h3>3. 語法錯誤</h3>
        <p>檢查 background.js 是否有語法錯誤，特別是最近修改的部分。</p>
    </div>

    <div class="section">
        <h2>💡 替代測試方案</h2>
        <button onclick="testDirectAPI()">測試 Chrome API</button>
        <button onclick="checkExtensions()">列出所有擴展</button>
        <div id="testResult"></div>
    </div>

    <script>
        function testDirectAPI() {
            const resultDiv = document.getElementById('testResult');
            try {
                if (typeof chrome !== 'undefined' && chrome.runtime) {
                    resultDiv.innerHTML = '<p class="success">✅ Chrome API 可用</p>';
                    
                    // 嘗試獲取擴展資訊
                    if (chrome.runtime.getManifest) {
                        try {
                            const manifest = chrome.runtime.getManifest();
                            resultDiv.innerHTML += '<p class="info">當前頁面在擴展內部環境中</p>';
                            resultDiv.innerHTML += '<pre>' + JSON.stringify(manifest, null, 2) + '</pre>';
                        } catch (e) {
                            resultDiv.innerHTML += '<p class="info">當前頁面不在擴展內部環境中</p>';
                        }
                    }
                } else {
                    resultDiv.innerHTML = '<p class="error">❌ Chrome API 不可用</p>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<p class="error">❌ 錯誤: ' + error.message + '</p>';
            }
        }

        function checkExtensions() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<p class="info">請手動檢查擴展列表...</p>';
            resultDiv.innerHTML += '<p>前往 chrome://extensions/ 查看所有已安裝的擴展</p>';
        }
    </script>
</body>
</html> 