<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task 23: DRM 偵測測試 - CDN Detector</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            margin: -20px -20px 20px -20px;
            padding: 20px;
            border-radius: 8px 8px 0 0;
        }
        .test-section {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: transform 0.2s;
        }
        .button:hover {
            transform: translateY(-2px);
        }
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        
        .log-container {
            background: #1e1e1e;
            color: #fff;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }
        .log-entry.info { color: #87CEEB; }
        .log-entry.error { color: #FF6B6B; }
        .log-entry.success { color: #98FB98; }
        .log-entry.warning { color: #FFD700; }
        
        .drm-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .drm-system {
            background: #e9ecef;
            border-left: 4px solid #667eea;
            padding: 10px;
            margin: 5px 0;
            border-radius: 0 4px 4px 0;
        }
        
        .mpd-sample {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .test-result {
            border: 2px solid #28a745;
            background: #d4edda;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        
        .test-result.failed {
            border-color: #dc3545;
            background: #f8d7da;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔒 Task 23: DRM 偵測測試</h1>
            <p>測試 CDN Detector 的 DRM (Digital Rights Management) 偵測功能</p>
        </div>

        <div class="test-section">
            <h3>📋 測試概述</h3>
            <p>本測試將驗證以下 DRM 偵測功能：</p>
            <ul>
                <li><strong>DASH MPD DRM 解析</strong>：解析 DASH manifest 中的 ContentProtection 元素</li>
                <li><strong>HLS DRM 偵測</strong>：檢測 HLS playlist 中的 EXT-X-KEY 加密</li>
                <li><strong>媒體段 DRM 偵測</strong>：分析 m4s 檔案的 DRM 保護狀態</li>
                <li><strong>多重 DRM 系統支援</strong>：Widevine、PlayReady、FairPlay 等</li>
                <li><strong>即時 DRM 監控</strong>：在影片播放過程中持續監控 DRM 狀態</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>🚀 快速測試</h3>
            <div class="status info" id="extensionStatus">正在檢查擴充功能狀態...</div>
            
            <button class="button" onclick="checkExtensionStatus()">🔄 重新檢查擴充功能</button>
            <button class="button" onclick="testLocalDRMParsing()">🧪 測試本地 DRM 解析</button>
            <button class="button" onclick="testGagaOOLalaMPD()">📺 測試 GagaOOLala MPD</button>
            <button class="button" onclick="testMultipleDRMSystems()">🔐 測試多重 DRM 系統</button>
            <button class="button" onclick="clearLogs()">🗑️ 清除日誌</button>
        </div>

        <div class="test-section">
            <h3>📊 DRM 偵測結果</h3>
            <div id="drmResults">
                <div class="status info">尚未執行 DRM 偵測測試</div>
            </div>
        </div>

        <div class="test-section">
            <h3>🔍 GagaOOLala MPD 範例分析</h3>
            <p>以下是從 GagaOOLala 取得的 MPD 檔案範例，包含 Widevine 和 PlayReady DRM 保護：</p>
            <div class="mpd-sample" id="mpdSample">
&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;MPD xmlns="urn:mpeg:dash:schema:mpd:2011"&gt;
  &lt;Period id="ebec6043-3c60-4e9d-9d02-8d87c026ba8e"&gt;
    &lt;AdaptationSet segmentAlignment="true" mimeType="video/mp4"&gt;
      &lt;ContentProtection xmlns:cenc="urn:mpeg:cenc:2013" 
                        schemeIdUri="urn:mpeg:dash:mp4protection:2011" 
                        value="cenc" 
                        cenc:default_KID="b468a4a4-7f0a-3a2c-12a2-1751c99159bf"/&gt;
      &lt;ContentProtection schemeIdUri="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"&gt;
        &lt;cenc:pssh xmlns:cenc="urn:mpeg:cenc:2013"&gt;AAAAQ3Bzc2gAAAAA7e+LqXnWSs6jyCfc1R0h7QAAACMIARIQAAECAwQFBgcICQoLDA0ODxoKaW50ZXJ0cnVzdCIBKg==&lt;/cenc:pssh&gt;
      &lt;/ContentProtection&gt;
      &lt;ContentProtection schemeIdUri="urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95"&gt;
        &lt;cenc:pssh xmlns:cenc="urn:mpeg:cenc:2013"&gt;AAACxnBzc2gAAAAAmgTweZhAQoarkuZb4IhflQAAAqamAgAAAQABAJwCPABXAFIATQBIAEUAQQBEAEUAUgAgAHgAbQBsAG4AcwA9ACIAaAB0AHQAcAA6AC8ALwBzAGMAaABlAG0AYQBzAC4AbQBpAGMAcgBvAHMAbwBmAHQALgBjAG8AbQAvAEQAUgBNAC8AMgAwADAANwAvADAAMwAvAFAAbABhAHkAUgBlAGEAZAB5AEgAZQBhAGQAZQByACIAIAB2AGUAcgBzAGkAbwBuAD0AIgA0AC4AMAAuADAALgAwACIAPgA8AEQAQQBUAEEAPgA8AFAAUgBPAFQARQBDAFQASQBOAEYATwA+ADwASwBFAFkATABFAE4APgAxADYAPAAvAEsARQBZAEwARQBOAD4APABBAEwARwBJAEQAPgBBAEUAUwBDAFQAUgA8AC8AQQBMAEcASQBEAD4APAAvAFAAUgBPAFQARQBDAFQASQBOAEYATwA+ADwASwBJAEQAPgBwAEsAUgBvAHQAQQBwAC8ATABEAG8AUwBvAGgAZABSAHkAWgBGAFoAdgB3AD0APQA8AC8ASwBJAEQAPgA8AEMASABFAEMASwBTAFUATQA+AEEAVwB1AG4AdQBKAHMAcQBwAHoAYwA9ADwALwBDAEgARQBDAEsAUwBVAE0APgA8AEwAQQBfAFUAUgBMAD4AaAB0AHQAcABzADoALwAvAHAAcgAuAHMAZQByAHYAaQBjAGUALgBlAHgAcAByAGUAcwBzAHAAbABhAHkALgBjAG8AbQAvAHAAbABhAHkAcgBlAGEAZAB5AC8AUgBpAGcAaAB0AHMATQBhAG4AYQBnAGUAcgAuAGEAcwBtAHgAPAAvAEwAQQBfAFUAUgBMAD4APAAvAEQAQQBUAEEAPgA8AC8AVwBSAE0ASABFAEEARABFAFIAPgA=&lt;/cenc:pssh&gt;
        &lt;mspr:pro xmlns:mspr="urn:microsoft:playready"&gt;pgIAAAEAAQCcAjwAVwBSAE0ASABFAEEARABFAFIAIAB4AG0AbABuAHMAPQAiAGgAdAB0AHAAOgAvAC8AcwBjAGgAZQBtAGEAcwAuAG0AaQBjAHIAbwBzAG8AZgB0AC4AYwBvAG0ALwBEAFIATQAvADIAMAAwADcALwAwADMALwBQAGwAYQB5AFIAZQBhAGQAeQBIAGUAYQBkAGUAcgAiACAAdgBlAHIAcwBpAG8AbgA9ACIANAAuADAALgAwAC4AMAAiAD4APABEAEEAVABBAD4APABQAFIATwBUAEUAQwBUAEkATgBGAE8APgA8AEsARQBZAEwARQBOAD4AMQA2ADwALwBLAEUAWQBMAEUATgA+ADwAQQBMAEcASQBEAD4AQQBFAFMAQwBUAFIAPAAvAEEATABHAEkARAA+ADwALwBQAFIATwBUAEUAQwBUAEkATgBGAE8APgA8AEsASQBEAD4AcABLAFIAbwB0AEEAcAAvAEwARABvAFMAbwBoAGQAUgB5AFoARgBaAHYAdwA9AD0APAAvAEsASQBEAD4APABDAEgARQBDAEsAUwBVAE0APgBBAFcAdQBuAHUASgBzAHEAcAB6AGMAPQA8AC8AQwBIAEUAQwBLAFMAVQBNAD4APABMAEEAXwBVAFIATAA+AGgAdAB0AHAAcwA6AC8ALwBwAHIALgBzAGUAcgB2AGkAYwBlAC4AZQB4AHAAcgBlAHMAcwBwAGwAYQB5AC4AYwBvAG0ALwBwAGwAYQB5AHIAZQBhAGQAeQAvAFIAaQBnAGgAdABzAE0AYQBuAGEAZwBlAHIALgBhAHMAbQB4ADwALwBMAEEAXwBVAFIATAA+ADwALwBEAEEAVABBAD4APAAvAFcAUgBNAEgARQBBAEQARQBSAD4A&lt;/mspr:pro&gt;
      &lt;/ContentProtection&gt;
    &lt;/AdaptationSet&gt;
  &lt;/Period&gt;
&lt;/MPD&gt;
            </div>
            <button class="button" onclick="analyzeMPDSample()">🔍 分析此 MPD 範例</button>
        </div>

        <div class="test-section">
            <h3>📈 測試進度</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div id="progressText">等待測試開始...</div>
        </div>

        <div class="test-section">
            <h3>📝 詳細日誌</h3>
            <div class="log-container" id="logContainer">
                <div class="log-entry info">[INFO] DRM 偵測測試頁面已載入</div>
                <div class="log-entry info">[INFO] 等待用戶操作...</div>
            </div>
        </div>
    </div>

    <script src="test-drm-detection.js"></script>
</body>
</html> 